datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum Role {
  USER
  ADMIN
}

model User {
  id            String    @id @default(cuid())
  slug          String    @unique
  name          String
  password      String
  email         String    @unique
  emailVerified DateTime?
  location      String?
  description   String?
  company       String?
  position      String?
  website       String?

  image     String   @default("/images/default-avatar.jpg")
  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())
  role      Role     @default(USER)

  eventAttendee EventAttendee[]

  @@map("user")
}

enum EventPermissionRole {
  FOUNDER
  ORGANIZER
  ATTENDEE
}

enum EventType {
  VIRTUAL
  IN_PERSON
  HYBRID
}

enum TimeFormat {
  TWELVE_HOURS
  TWENTYFOUR_HOURS
}

enum EventCategory {
  EVENT
  ACADEMIC
  BUSINESS
  CONFERENCE
  CONVENTION
  FESTIVAL
  OTHER
}

enum EventLevel {
  TRIAL
  PRO
}

model Event {
  id          String        @id @default(cuid())
  slug        String        @unique
  name        String
  location    String?
  address     String?
  level       EventLevel    @default(TRIAL)
  timeFormat  TimeFormat    @default(TWELVE_HOURS)
  startDate   DateTime
  endDate     DateTime
  type        EventType?
  category    EventCategory @default(EVENT)
  image       String        @default("/images/default-event.jpg")
  banner      String?
  description String?
  updatedAt   DateTime      @updatedAt
  createdAt   DateTime      @default(now())

  attendee        EventAttendee[]
  session         EventSession[]
  venue           EventVenue[]
  role            EventRole[]
  sessionAttendee EventSessionAttendee[]

  @@map("event")
}

model EventAttendee {
  id             String              @id @default(cuid())
  userId         String
  eventId        String
  eventRoleId    String
  permissionRole EventPermissionRole

  role  EventRole @relation(fields: [eventRoleId], references: [id])
  user  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  event Event     @relation(fields: [eventId], references: [id], onDelete: Cascade)

  sessionAttendee EventSessionAttendee[]

  @@unique([eventId, userId])
  @@map("event_attendee")
}

model EventRole {
  id          String  @id @default(cuid())
  eventId     String
  slug        String
  name        String
  defaultRole Boolean @default(false)

  event Event @relation(fields: [eventId], references: [id], onDelete: Cascade)

  attendee EventAttendee[]

  @@unique([eventId, slug])
  @@map("event_role")
}

model EventSession {
  id          String   @id @default(cuid())
  slug        String
  eventId     String
  startDate   DateTime
  endDate     DateTime
  venueId     String?
  name        String
  description String?
  updatedAt   DateTime @updatedAt
  createdAt   DateTime @default(now())

  event Event      @relation(fields: [eventId], references: [id], onDelete: Cascade)
  venue EventVenue? @relation(fields: [venueId], references: [id], onDelete: Cascade)

  sessionAttendee EventSessionAttendee[]

  @@unique([eventId, slug])
  @@map("event_session")
}

model EventSessionAttendee {
  id         String @id @default(cuid())
  sessionId  String
  attendeeId String
  eventId    String

  event    Event         @relation(fields: [eventId], references: [id], onDelete: Cascade)
  session  EventSession  @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  attendee EventAttendee @relation(fields: [attendeeId], references: [id], onDelete: Cascade)

  @@unique([eventId, sessionId, attendeeId])
  @@map("event_session_attendee")
}

model EventVenue {
  id          String   @id @default(cuid())
  slug        String
  eventId     String
  name        String
  address String?
  description String?
  updatedAt   DateTime @updatedAt
  createdAt   DateTime @default(now())

  event Event @relation(fields: [eventId], references: [id], onDelete: Cascade)

  session EventSession[]

  @@unique([eventId, slug])
  @@map("event_venue")
}
